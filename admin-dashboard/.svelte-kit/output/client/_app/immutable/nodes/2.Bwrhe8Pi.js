import{S as fe,i as me,s as de,n as oe,d as g,e as z,f as G,h as u,G as y,j as D,k as C,l as B,m as b,o as I,p as F,q as S,C as k,t as q,a as T,E as A,J as _e,F as j,D as J,z as ge,K as ce}from"../chunks/BDr4HxwF.js";import"../chunks/IHki7fMi.js";const ve="http://localhost:8000/api/v1";async function he(r,e={}){const t=await fetch(`${ve}${r}`,{...e,headers:{"Content-Type":"application/json",...e.headers||{}},credentials:"include"});if(!t.ok)throw new Error(`HTTP ${t.status}`);return t.json()}function $e(r,e){const t=new EventSource(`${ve}${r}`,{withCredentials:!0});return t.onmessage=e,t}function pe(r){let e,t,a,o,i,m=(r[1]??"–")+"",n;return{c(){e=I("div"),t=I("div"),a=F(r[0]),o=S(),i=I("div"),n=F(m),this.h()},l(l){e=D(l,"DIV",{class:!0});var d=C(e);t=D(d,"DIV",{class:!0});var _=C(t);a=B(_,r[0]),_.forEach(g),o=b(d),i=D(d,"DIV",{class:!0});var V=C(i);n=B(V,m),V.forEach(g),d.forEach(g),this.h()},h(){y(t,"class","text-sm text-gray-400"),y(i,"class","mt-1 text-3xl font-semibold"),y(e,"class","glass rounded-xl p-4")},m(l,d){G(l,e,d),u(e,t),u(t,a),u(e,o),u(e,i),u(i,n)},p(l,[d]){d&1&&z(a,l[0]),d&2&&m!==(m=(l[1]??"–")+"")&&z(n,m)},i:oe,o:oe,d(l){l&&g(e)}}}function we(r,e,t){let{title:a}=e,{value:o}=e;return r.$$set=i=>{"title"in i&&t(0,a=i.title),"value"in i&&t(1,o=i.value)},[a,o]}class P extends fe{constructor(e){super(),me(this,e,we,pe,de,{title:0,value:1})}}function ue(r){let e,t;return{c(){e=I("div"),t=F(r[1]),this.h()},l(a){e=D(a,"DIV",{class:!0});var o=C(e);t=B(o,r[1]),o.forEach(g),this.h()},h(){y(e,"class","p-3 rounded bg-red-900/40 border border-red-700")},m(a,o){G(a,e,o),u(e,t)},p(a,o){o&2&&z(t,a[1])},d(a){a&&g(e)}}}function Ee(r){var K,L,M,N,x,Q,W;let e,t,a,o="Overview",i,m,n,l,d,_,V,$,O,p,R,w,U,E,H,c=r[1]&&ue(r);return l=new P({props:{title:"Requests / min",value:(K=r[0])==null?void 0:K.requests_per_minute}}),_=new P({props:{title:"Avg response (ms)",value:(L=r[0])==null?void 0:L.average_response_time}}),$=new P({props:{title:"Success rate (%)",value:(M=r[0])==null?void 0:M.success_rate}}),p=new P({props:{title:"Active sessions",value:(N=r[0])==null?void 0:N.active_sessions}}),w=new P({props:{title:"Cost today (USD)",value:(x=r[0])==null?void 0:x.total_cost_today}}),E=new P({props:{title:"Top errors",value:((W=(Q=r[0])==null?void 0:Q.top_errors)==null?void 0:W[0])??"-"}}),{c(){e=I("div"),t=I("div"),a=I("h1"),a.textContent=o,i=S(),c&&c.c(),m=S(),n=I("div"),J(l.$$.fragment),d=S(),J(_.$$.fragment),V=S(),J($.$$.fragment),O=S(),J(p.$$.fragment),R=S(),J(w.$$.fragment),U=S(),J(E.$$.fragment),this.h()},l(s){e=D(s,"DIV",{class:!0});var v=C(e);t=D(v,"DIV",{class:!0});var h=C(t);a=D(h,"H1",{class:!0,"data-svelte-h":!0}),_e(a)!=="svelte-hrvmfv"&&(a.textContent=o),i=b(h),c&&c.l(h),m=b(h),n=D(h,"DIV",{class:!0});var f=C(n);j(l.$$.fragment,f),d=b(f),j(_.$$.fragment,f),V=b(f),j($.$$.fragment,f),O=b(f),j(p.$$.fragment,f),R=b(f),j(w.$$.fragment,f),U=b(f),j(E.$$.fragment,f),f.forEach(g),h.forEach(g),v.forEach(g),this.h()},h(){y(a,"class","text-2xl font-semibold mb-6"),y(n,"class","grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4"),y(t,"class","mx-auto max-w-7xl p-6"),y(e,"class","min-h-screen bg-gray-900 text-gray-100")},m(s,v){G(s,e,v),u(e,t),u(t,a),u(t,i),c&&c.m(t,null),u(t,m),u(t,n),A(l,n,null),u(n,d),A(_,n,null),u(n,V),A($,n,null),u(n,O),A(p,n,null),u(n,R),A(w,n,null),u(n,U),A(E,n,null),H=!0},p(s,[v]){var te,se,ae,ne,re,le,ie;s[1]?c?c.p(s,v):(c=ue(s),c.c(),c.m(t,m)):c&&(c.d(1),c=null);const h={};v&1&&(h.value=(te=s[0])==null?void 0:te.requests_per_minute),l.$set(h);const f={};v&1&&(f.value=(se=s[0])==null?void 0:se.average_response_time),_.$set(f);const X={};v&1&&(X.value=(ae=s[0])==null?void 0:ae.success_rate),$.$set(X);const Y={};v&1&&(Y.value=(ne=s[0])==null?void 0:ne.active_sessions),p.$set(Y);const Z={};v&1&&(Z.value=(re=s[0])==null?void 0:re.total_cost_today),w.$set(Z);const ee={};v&1&&(ee.value=((ie=(le=s[0])==null?void 0:le.top_errors)==null?void 0:ie[0])??"-"),E.$set(ee)},i(s){H||(T(l.$$.fragment,s),T(_.$$.fragment,s),T($.$$.fragment,s),T(p.$$.fragment,s),T(w.$$.fragment,s),T(E.$$.fragment,s),H=!0)},o(s){q(l.$$.fragment,s),q(_.$$.fragment,s),q($.$$.fragment,s),q(p.$$.fragment,s),q(w.$$.fragment,s),q(E.$$.fragment,s),H=!1},d(s){s&&g(e),c&&c.d(),k(l),k(_),k($),k(p),k(w),k(E)}}}function be(r,e,t){let a=null,o=null,i=null;async function m(){try{t(0,a=await he("/analytics/dashboard"))}catch(n){t(1,o=n.message)}}return ge(()=>{m();try{i=$e("/analytics/stream",n=>{try{const l=JSON.parse(n.data);l!=null&&l.timestamp&&t(0,a=l)}catch{}})}catch{console.warn("SSE unavailable, falling back to polling");const l=setInterval(m,5e3);ce(()=>clearInterval(l))}}),ce(()=>{i==null||i.close()}),[a,o]}class De extends fe{constructor(e){super(),me(this,e,be,Ee,de,{})}}export{De as component};
