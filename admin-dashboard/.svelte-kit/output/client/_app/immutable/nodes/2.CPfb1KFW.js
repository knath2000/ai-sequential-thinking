import{S as ne,i as re,s as oe,n as Z,d as b,a as M,b as B,c as a,e as E,f as $,g as k,h as q,j as A,k as w,t as L,l as P,m as Ce,L as ce,p as X,o as fe,F as z,u as G,v as J,H as W,I as F,G as Y,M as Ee}from"../chunks/CU9EupLQ.js";import"../chunks/IHki7fMi.js";import{A as ie,e as ae}from"../chunks/Cw8VPk3b.js";async function Re(l,e={}){const t=await fetch(`${ie}${l}`,{...e,headers:{"Content-Type":"application/json",...e.headers||{}},credentials:"include"});if(!t.ok)throw new Error(`HTTP ${t.status}`);return t.json()}function Ve(l,e){const t=new EventSource(`${ie}${l}`,{withCredentials:!0});return t.onmessage=e,t}function Ae(l){let e,t,s,o,u,c=(l[1]??"–")+"",f;return{c(){e=w("div"),t=w("div"),s=L(l[0]),o=P(),u=w("div"),f=L(c),this.h()},l(r){e=$(r,"DIV",{class:!0});var i=k(e);t=$(i,"DIV",{class:!0});var v=k(t);s=q(v,l[0]),v.forEach(b),o=A(i),u=$(i,"DIV",{class:!0});var I=k(u);f=q(I,c),I.forEach(b),i.forEach(b),this.h()},h(){E(t,"class","text-sm text-gray-400"),E(u,"class","mt-1 text-3xl font-semibold"),E(e,"class","glass rounded-xl p-4")},m(r,i){B(r,e,i),a(e,t),a(t,s),a(e,o),a(e,u),a(u,f)},p(r,[i]){i&1&&M(s,r[0]),i&2&&c!==(c=(r[1]??"–")+"")&&M(f,c)},i:Z,o:Z,d(r){r&&b(e)}}}function Pe(l,e,t){let{title:s}=e,{value:o}=e;return l.$$set=u=>{"title"in u&&t(0,s=u.title),"value"in u&&t(1,o=u.value)},[s,o]}class Q extends ne{constructor(e){super(),re(this,e,Pe,Ae,oe,{title:0,value:1})}}function ye(l,e,t){const s=l.slice();return s[6]=e[t],s}function Se(l){let e,t;return{c(){e=w("div"),t=L(l[1]),this.h()},l(s){e=$(s,"DIV",{class:!0});var o=k(e);t=q(o,l[1]),o.forEach(b),this.h()},h(){E(e,"class","p-3 text-red-400 text-sm")},m(s,o){B(s,e,o),a(e,t)},p(s,o){o&2&&M(t,s[1])},d(s){s&&b(e)}}}function De(l){let e,t,s,o=l[6].ts+"",u,c,f,r,i=l[6].level+"",v,I,C,y,D=l[6].name+"",m,h,T,n=l[6].message+"",V,_;return{c(){e=w("div"),t=w("span"),s=L("["),u=L(o),c=L("]"),f=P(),r=w("span"),v=L(i),C=P(),y=w("span"),m=L(D),h=P(),T=w("span"),V=L(n),_=P(),this.h()},l(d){e=$(d,"DIV",{class:!0});var g=k(e);t=$(g,"SPAN",{class:!0});var p=k(t);s=q(p,"["),u=q(p,o),c=q(p,"]"),p.forEach(b),f=A(g),r=$(g,"SPAN",{class:!0});var N=k(r);v=q(N,i),N.forEach(b),C=A(g),y=$(g,"SPAN",{class:!0});var x=k(y);m=q(x,D),x.forEach(b),h=A(g),T=$(g,"SPAN",{class:!0});var R=k(T);V=q(R,n),R.forEach(b),_=A(g),g.forEach(b),this.h()},h(){E(t,"class","text-gray-500"),E(r,"class",I="ml-1 font-semibold "+(l[6].level==="ERROR"?"text-red-400":l[6].level==="WARNING"?"text-yellow-400":"text-green-400")),E(y,"class","ml-1 text-gray-400"),E(T,"class","ml-2"),E(e,"class","px-3 py-1 whitespace-pre-wrap")},m(d,g){B(d,e,g),a(e,t),a(t,s),a(t,u),a(t,c),a(e,f),a(e,r),a(r,v),a(e,C),a(e,y),a(y,m),a(e,h),a(e,T),a(T,V),a(e,_)},p(d,g){g&1&&o!==(o=d[6].ts+"")&&M(u,o),g&1&&i!==(i=d[6].level+"")&&M(v,i),g&1&&I!==(I="ml-1 font-semibold "+(d[6].level==="ERROR"?"text-red-400":d[6].level==="WARNING"?"text-yellow-400":"text-green-400"))&&E(r,"class",I),g&1&&D!==(D=d[6].name+"")&&M(m,D),g&1&&n!==(n=d[6].message+"")&&M(V,n)},d(d){d&&b(e)}}}function qe(l){let e,t,s,o="Recent Logs",u,c,f="Refresh",r,i,v,I,C,y=l[1]&&Se(l),D=ae(l[0]),m=[];for(let h=0;h<D.length;h+=1)m[h]=De(ye(l,D,h));return{c(){e=w("div"),t=w("div"),s=w("div"),s.textContent=o,u=P(),c=w("button"),c.textContent=f,r=P(),y&&y.c(),i=P(),v=w("div");for(let h=0;h<m.length;h+=1)m[h].c();this.h()},l(h){e=$(h,"DIV",{class:!0});var T=k(e);t=$(T,"DIV",{class:!0});var n=k(t);s=$(n,"DIV",{class:!0,"data-svelte-h":!0}),X(s)!=="svelte-64tdm0"&&(s.textContent=o),u=A(n),c=$(n,"BUTTON",{class:!0,"data-svelte-h":!0}),X(c)!=="svelte-9svlmm"&&(c.textContent=f),n.forEach(b),r=A(T),y&&y.l(T),i=A(T),v=$(T,"DIV",{class:!0});var V=k(v);for(let _=0;_<m.length;_+=1)m[_].l(V);V.forEach(b),T.forEach(b),this.h()},h(){E(s,"class","text-sm font-semibold"),E(c,"class","text-xs text-blue-400 hover:underline"),E(t,"class","flex items-center justify-between px-3 py-2 border-b border-gray-700"),E(v,"class","max-h-64 overflow-auto text-xs"),E(e,"class","rounded-lg border border-gray-700 bg-gray-900/60")},m(h,T){B(h,e,T),a(e,t),a(t,s),a(t,u),a(t,c),a(e,r),y&&y.m(e,null),a(e,i),a(e,v);for(let n=0;n<m.length;n+=1)m[n]&&m[n].m(v,null);I||(C=ce(c,"click",l[2]),I=!0)},p(h,[T]){if(h[1]?y?y.p(h,T):(y=Se(h),y.c(),y.m(e,i)):y&&(y.d(1),y=null),T&1){D=ae(h[0]);let n;for(n=0;n<D.length;n+=1){const V=ye(h,D,n);m[n]?m[n].p(V,T):(m[n]=De(V),m[n].c(),m[n].m(v,null))}for(;n<m.length;n+=1)m[n].d(1);m.length=D.length}},i:Z,o:Z,d(h){h&&b(e),y&&y.d(),Ce(m,h),I=!1,C()}}}function Le(l,e,t){let{pollMs:s=3e3}=e,{max:o=200}=e,{level:u}=e,c=[],f=null;async function r(){try{const i=new URLSearchParams;i.set("limit",String(o)),u&&i.set("level",u);const v=await fetch(`${ie}/analytics/logs?${i.toString()}`,{credentials:"include"});if(!v.ok)throw new Error(`HTTP ${v.status}`);t(0,c=await v.json()),t(1,f=null)}catch(i){t(1,f=i.message)}}return fe(()=>{r();const i=setInterval(r,s);return()=>clearInterval(i)}),l.$$set=i=>{"pollMs"in i&&t(3,s=i.pollMs),"max"in i&&t(4,o=i.max),"level"in i&&t(5,u=i.level)},[c,f,r,s,o,u]}class Ne extends ne{constructor(e){super(),re(this,e,Le,qe,oe,{pollMs:3,max:4,level:5})}}function xe(l,e,t){const s=l.slice();return s[5]=e[t],s}function Ie(l){let e,t;return{c(){e=w("div"),t=L(l[1]),this.h()},l(s){e=$(s,"DIV",{class:!0});var o=k(e);t=q(o,l[1]),o.forEach(b),this.h()},h(){E(e,"class","p-3 text-red-400 text-sm")},m(s,o){B(s,e,o),a(e,t)},p(s,o){o&2&&M(t,s[1])},d(s){s&&b(e)}}}function Te(l){let e,t,s=l[5].session_id+"",o,u,c,f=new Date(l[5].created_at).toLocaleString()+"",r,i,v,I=l[5].total_requests+"",C,y,D,m=l[5].total_errors+"",h,T,n,V=l[5].total_processing_time_ms+"",_,d,g,p;function N(){return l[4](l[5])}return{c(){e=w("tr"),t=w("td"),o=L(s),u=P(),c=w("td"),r=L(f),i=P(),v=w("td"),C=L(I),y=P(),D=w("td"),h=L(m),T=P(),n=w("td"),_=L(V),d=P(),this.h()},l(x){e=$(x,"TR",{class:!0});var R=k(e);t=$(R,"TD",{class:!0});var U=k(t);o=q(U,s),U.forEach(b),u=A(R),c=$(R,"TD",{class:!0});var ee=k(c);r=q(ee,f),ee.forEach(b),i=A(R),v=$(R,"TD",{class:!0});var te=k(v);C=q(te,I),te.forEach(b),y=A(R),D=$(R,"TD",{class:!0});var se=k(D);h=q(se,m),se.forEach(b),T=A(R),n=$(R,"TD",{class:!0});var le=k(n);_=q(le,V),le.forEach(b),d=A(R),R.forEach(b),this.h()},h(){E(t,"class","px-3 py-2 font-mono"),E(c,"class","px-3 py-2"),E(v,"class","px-3 py-2"),E(D,"class","px-3 py-2"),E(n,"class","px-3 py-2"),E(e,"class","border-t border-gray-800 hover:bg-gray-800/40 cursor-pointer")},m(x,R){B(x,e,R),a(e,t),a(t,o),a(e,u),a(e,c),a(c,r),a(e,i),a(e,v),a(v,C),a(e,y),a(e,D),a(D,h),a(e,T),a(e,n),a(n,_),a(e,d),g||(p=ce(e,"click",N),g=!0)},p(x,R){l=x,R&1&&s!==(s=l[5].session_id+"")&&M(o,s),R&1&&f!==(f=new Date(l[5].created_at).toLocaleString()+"")&&M(r,f),R&1&&I!==(I=l[5].total_requests+"")&&M(C,I),R&1&&m!==(m=l[5].total_errors+"")&&M(h,m),R&1&&V!==(V=l[5].total_processing_time_ms+"")&&M(_,V)},d(x){x&&b(e),g=!1,p()}}}function He(l){let e,t,s,o="Recent Sessions",u,c,f="Refresh",r,i,v,I,C,y='<tr><th class="px-3 py-2">Session</th> <th class="px-3 py-2">Created</th> <th class="px-3 py-2">Requests</th> <th class="px-3 py-2">Errors</th> <th class="px-3 py-2">Proc (ms)</th></tr>',D,m,h,T,n=l[1]&&Ie(l),V=ae(l[0]),_=[];for(let d=0;d<V.length;d+=1)_[d]=Te(xe(l,V,d));return{c(){e=w("div"),t=w("div"),s=w("div"),s.textContent=o,u=P(),c=w("button"),c.textContent=f,r=P(),n&&n.c(),i=P(),v=w("div"),I=w("table"),C=w("thead"),C.innerHTML=y,D=P(),m=w("tbody");for(let d=0;d<_.length;d+=1)_[d].c();this.h()},l(d){e=$(d,"DIV",{class:!0});var g=k(e);t=$(g,"DIV",{class:!0});var p=k(t);s=$(p,"DIV",{class:!0,"data-svelte-h":!0}),X(s)!=="svelte-1d3eqnm"&&(s.textContent=o),u=A(p),c=$(p,"BUTTON",{class:!0,"data-svelte-h":!0}),X(c)!=="svelte-9svlmm"&&(c.textContent=f),p.forEach(b),r=A(g),n&&n.l(g),i=A(g),v=$(g,"DIV",{class:!0});var N=k(v);I=$(N,"TABLE",{class:!0});var x=k(I);C=$(x,"THEAD",{class:!0,"data-svelte-h":!0}),X(C)!=="svelte-1dstrq3"&&(C.innerHTML=y),D=A(x),m=$(x,"TBODY",{});var R=k(m);for(let U=0;U<_.length;U+=1)_[U].l(R);R.forEach(b),x.forEach(b),N.forEach(b),g.forEach(b),this.h()},h(){E(s,"class","text-sm font-semibold"),E(c,"class","text-xs text-blue-400 hover:underline"),E(t,"class","flex items-center justify-between px-3 py-2 border-b border-gray-700"),E(C,"class","bg-gray-800 text-gray-300"),E(I,"class","min-w-full text-left text-xs"),E(v,"class","overflow-auto"),E(e,"class","rounded-lg border border-gray-700 bg-gray-900/60")},m(d,g){B(d,e,g),a(e,t),a(t,s),a(t,u),a(t,c),a(e,r),n&&n.m(e,null),a(e,i),a(e,v),a(v,I),a(I,C),a(I,D),a(I,m);for(let p=0;p<_.length;p+=1)_[p]&&_[p].m(m,null);h||(T=ce(c,"click",l[2]),h=!0)},p(d,[g]){if(d[1]?n?n.p(d,g):(n=Ie(d),n.c(),n.m(e,i)):n&&(n.d(1),n=null),g&1){V=ae(d[0]);let p;for(p=0;p<V.length;p+=1){const N=xe(d,V,p);_[p]?_[p].p(N,g):(_[p]=Te(N),_[p].c(),_[p].m(m,null))}for(;p<_.length;p+=1)_[p].d(1);_.length=V.length}},i:Z,o:Z,d(d){d&&b(e),n&&n.d(),Ce(_,d),h=!1,T()}}}function Me(l,e,t){let{pageSize:s=20}=e,o=[],u=null;async function c(){try{const r=new URLSearchParams;r.set("limit",String(s));const i=await fetch(`${ie}/analytics/sessions?${r.toString()}`,{credentials:"include"});if(!i.ok)throw new Error(`HTTP ${i.status}`);t(0,o=await i.json()),t(1,u=null)}catch(r){t(1,u=r.message)}}fe(()=>{c()});const f=r=>window.location.href=`/dashboard/session/${r.session_id}`;return l.$$set=r=>{"pageSize"in r&&t(3,s=r.pageSize)},[o,u,c,s,f]}class je extends ne{constructor(e){super(),re(this,e,Me,He,oe,{pageSize:3})}}function ke(l){let e,t;return{c(){e=w("div"),t=L(l[1]),this.h()},l(s){e=$(s,"DIV",{class:!0});var o=k(e);t=q(o,l[1]),o.forEach(b),this.h()},h(){E(e,"class","p-3 rounded bg-red-900/40 border border-red-700")},m(s,o){B(s,e,o),a(e,t)},p(s,o){o&2&&M(t,s[1])},d(s){s&&b(e)}}}function Oe(l){var R,U,ee,te,se,le,ue;let e,t,s,o="Overview",u,c,f,r,i,v,I,C,y,D,m,h,T,n,V,_,d,g,p,N,x=l[1]&&ke(l);return r=new Q({props:{title:"Requests / min",value:(R=l[0])==null?void 0:R.requests_per_minute}}),v=new Q({props:{title:"Avg response (ms)",value:(U=l[0])==null?void 0:U.average_response_time}}),C=new Q({props:{title:"Success rate (%)",value:(ee=l[0])==null?void 0:ee.success_rate}}),D=new Q({props:{title:"Active sessions",value:(te=l[0])==null?void 0:te.active_sessions}}),h=new Q({props:{title:"Cost today (USD)",value:(se=l[0])==null?void 0:se.total_cost_today}}),n=new Q({props:{title:"Top errors",value:((ue=(le=l[0])==null?void 0:le.top_errors)==null?void 0:ue[0])??"-"}}),d=new Ne({}),p=new je({}),{c(){e=w("div"),t=w("div"),s=w("h1"),s.textContent=o,u=P(),x&&x.c(),c=P(),f=w("div"),Y(r.$$.fragment),i=P(),Y(v.$$.fragment),I=P(),Y(C.$$.fragment),y=P(),Y(D.$$.fragment),m=P(),Y(h.$$.fragment),T=P(),Y(n.$$.fragment),V=P(),_=w("div"),Y(d.$$.fragment),g=P(),Y(p.$$.fragment),this.h()},l(S){e=$(S,"DIV",{class:!0});var j=k(e);t=$(j,"DIV",{class:!0});var O=k(t);s=$(O,"H1",{class:!0,"data-svelte-h":!0}),X(s)!=="svelte-hrvmfv"&&(s.textContent=o),u=A(O),x&&x.l(O),c=A(O),f=$(O,"DIV",{class:!0});var H=k(f);F(r.$$.fragment,H),i=A(H),F(v.$$.fragment,H),I=A(H),F(C.$$.fragment,H),y=A(H),F(D.$$.fragment,H),m=A(H),F(h.$$.fragment,H),T=A(H),F(n.$$.fragment,H),H.forEach(b),V=A(O),_=$(O,"DIV",{class:!0});var K=k(_);F(d.$$.fragment,K),g=A(K),F(p.$$.fragment,K),K.forEach(b),O.forEach(b),j.forEach(b),this.h()},h(){E(s,"class","text-2xl font-semibold mb-6"),E(f,"class","grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4"),E(_,"class","mt-8 grid grid-cols-1 lg:grid-cols-2 gap-4"),E(t,"class","mx-auto max-w-7xl p-6"),E(e,"class","min-h-screen bg-gray-900 text-gray-100")},m(S,j){B(S,e,j),a(e,t),a(t,s),a(t,u),x&&x.m(t,null),a(t,c),a(t,f),W(r,f,null),a(f,i),W(v,f,null),a(f,I),W(C,f,null),a(f,y),W(D,f,null),a(f,m),W(h,f,null),a(f,T),W(n,f,null),a(t,V),a(t,_),W(d,_,null),a(_,g),W(p,_,null),N=!0},p(S,[j]){var me,_e,ge,pe,be,$e,we;S[1]?x?x.p(S,j):(x=ke(S),x.c(),x.m(t,c)):x&&(x.d(1),x=null);const O={};j&1&&(O.value=(me=S[0])==null?void 0:me.requests_per_minute),r.$set(O);const H={};j&1&&(H.value=(_e=S[0])==null?void 0:_e.average_response_time),v.$set(H);const K={};j&1&&(K.value=(ge=S[0])==null?void 0:ge.success_rate),C.$set(K);const de={};j&1&&(de.value=(pe=S[0])==null?void 0:pe.active_sessions),D.$set(de);const he={};j&1&&(he.value=(be=S[0])==null?void 0:be.total_cost_today),h.$set(he);const ve={};j&1&&(ve.value=((we=($e=S[0])==null?void 0:$e.top_errors)==null?void 0:we[0])??"-"),n.$set(ve)},i(S){N||(J(r.$$.fragment,S),J(v.$$.fragment,S),J(C.$$.fragment,S),J(D.$$.fragment,S),J(h.$$.fragment,S),J(n.$$.fragment,S),J(d.$$.fragment,S),J(p.$$.fragment,S),N=!0)},o(S){G(r.$$.fragment,S),G(v.$$.fragment,S),G(C.$$.fragment,S),G(D.$$.fragment,S),G(h.$$.fragment,S),G(n.$$.fragment,S),G(d.$$.fragment,S),G(p.$$.fragment,S),N=!1},d(S){S&&b(e),x&&x.d(),z(r),z(v),z(C),z(D),z(h),z(n),z(d),z(p)}}}function Ue(l,e,t){let s=null,o=null,u=null;async function c(){try{t(0,s=await Re("/analytics/dashboard"))}catch(f){t(1,o=f.message)}}return fe(()=>{c();try{u=Ve("/analytics/stream",f=>{try{const r=JSON.parse(f.data);r!=null&&r.timestamp&&t(0,s=r)}catch{}})}catch{console.warn("SSE unavailable, falling back to polling");const r=setInterval(c,5e3);Ee(()=>clearInterval(r))}}),Ee(()=>{u==null||u.close()}),[s,o]}class Je extends ne{constructor(e){super(),re(this,e,Ue,Oe,oe,{})}}export{Je as component};
