import{S as se,i as le,s as ne,n as Z,d as b,e as M,f as z,h as n,G as w,j as $,k as T,l as P,m as A,o as E,p as L,q as k,J as Ce,K as Re,L as X,z as oe,M as re,C as B,t as G,a as J,E as W,F,D as K}from"../chunks/B_KXYxee.js";import"../chunks/IHki7fMi.js";function te(l){return(l==null?void 0:l.length)!==void 0?l:Array.from(l)}const ae="https://gallant-reflection-production.up.railway.app/api/v1";async function Ve(l,e={}){const t=await fetch(`${ae}${l}`,{...e,headers:{"Content-Type":"application/json",...e.headers||{}},credentials:"include"});if(!t.ok)throw new Error(`HTTP ${t.status}`);return t.json()}function Ae(l,e){const t=new EventSource(`${ae}${l}`,{withCredentials:!0});return t.onmessage=e,t}function ke(l){let e,t,s,r,d,f=(l[1]??"–")+"",i;return{c(){e=E("div"),t=E("div"),s=L(l[0]),r=k(),d=E("div"),i=L(f),this.h()},l(c){e=$(c,"DIV",{class:!0});var u=T(e);t=$(u,"DIV",{class:!0});var g=T(t);s=P(g,l[0]),g.forEach(b),r=A(u),d=$(u,"DIV",{class:!0});var S=T(d);i=P(S,f),S.forEach(b),u.forEach(b),this.h()},h(){w(t,"class","text-sm text-gray-400"),w(d,"class","mt-1 text-3xl font-semibold"),w(e,"class","glass rounded-xl p-4")},m(c,u){z(c,e,u),n(e,t),n(t,s),n(e,r),n(e,d),n(d,i)},p(c,[u]){u&1&&M(s,c[0]),u&2&&f!==(f=(c[1]??"–")+"")&&M(i,f)},i:Z,o:Z,d(c){c&&b(e)}}}function qe(l,e,t){let{title:s}=e,{value:r}=e;return l.$$set=d=>{"title"in d&&t(0,s=d.title),"value"in d&&t(1,r=d.value)},[s,r]}class Q extends se{constructor(e){super(),le(this,e,qe,ke,ne,{title:0,value:1})}}function we(l,e,t){const s=l.slice();return s[6]=e[t],s}function ye(l){let e,t;return{c(){e=E("div"),t=L(l[1]),this.h()},l(s){e=$(s,"DIV",{class:!0});var r=T(e);t=P(r,l[1]),r.forEach(b),this.h()},h(){w(e,"class","p-3 text-red-400 text-sm")},m(s,r){z(s,e,r),n(e,t)},p(s,r){r&2&&M(t,s[1])},d(s){s&&b(e)}}}function xe(l){let e,t,s,r=l[6].ts+"",d,f,i,c,u=l[6].level+"",g,S,C,y,D=l[6].name+"",_,m,I,a=l[6].message+"",R,p;return{c(){e=E("div"),t=E("span"),s=L("["),d=L(r),f=L("]"),i=k(),c=E("span"),g=L(u),C=k(),y=E("span"),_=L(D),m=k(),I=E("span"),R=L(a),p=k(),this.h()},l(h){e=$(h,"DIV",{class:!0});var v=T(e);t=$(v,"SPAN",{class:!0});var o=T(t);s=P(o,"["),d=P(o,r),f=P(o,"]"),o.forEach(b),i=A(v),c=$(v,"SPAN",{class:!0});var q=T(c);g=P(q,u),q.forEach(b),C=A(v),y=$(v,"SPAN",{class:!0});var V=T(y);_=P(V,D),V.forEach(b),m=A(v),I=$(v,"SPAN",{class:!0});var H=T(I);R=P(H,a),H.forEach(b),p=A(v),v.forEach(b),this.h()},h(){w(t,"class","text-gray-500"),w(c,"class",S="ml-1 font-semibold "+(l[6].level==="ERROR"?"text-red-400":l[6].level==="WARNING"?"text-yellow-400":"text-green-400")),w(y,"class","ml-1 text-gray-400"),w(I,"class","ml-2"),w(e,"class","px-3 py-1 whitespace-pre-wrap")},m(h,v){z(h,e,v),n(e,t),n(t,s),n(t,d),n(t,f),n(e,i),n(e,c),n(c,g),n(e,C),n(e,y),n(y,_),n(e,m),n(e,I),n(I,R),n(e,p)},p(h,v){v&1&&r!==(r=h[6].ts+"")&&M(d,r),v&1&&u!==(u=h[6].level+"")&&M(g,u),v&1&&S!==(S="ml-1 font-semibold "+(h[6].level==="ERROR"?"text-red-400":h[6].level==="WARNING"?"text-yellow-400":"text-green-400"))&&w(c,"class",S),v&1&&D!==(D=h[6].name+"")&&M(_,D),v&1&&a!==(a=h[6].message+"")&&M(R,a)},d(h){h&&b(e)}}}function Pe(l){let e,t,s,r="Recent Logs",d,f,i="Refresh",c,u,g,S,C,y=l[1]&&ye(l),D=te(l[0]),_=[];for(let m=0;m<D.length;m+=1)_[m]=xe(we(l,D,m));return{c(){e=E("div"),t=E("div"),s=E("div"),s.textContent=r,d=k(),f=E("button"),f.textContent=i,c=k(),y&&y.c(),u=k(),g=E("div");for(let m=0;m<_.length;m+=1)_[m].c();this.h()},l(m){e=$(m,"DIV",{class:!0});var I=T(e);t=$(I,"DIV",{class:!0});var a=T(t);s=$(a,"DIV",{class:!0,"data-svelte-h":!0}),X(s)!=="svelte-64tdm0"&&(s.textContent=r),d=A(a),f=$(a,"BUTTON",{class:!0,"data-svelte-h":!0}),X(f)!=="svelte-9svlmm"&&(f.textContent=i),a.forEach(b),c=A(I),y&&y.l(I),u=A(I),g=$(I,"DIV",{class:!0});var R=T(g);for(let p=0;p<_.length;p+=1)_[p].l(R);R.forEach(b),I.forEach(b),this.h()},h(){w(s,"class","text-sm font-semibold"),w(f,"class","text-xs text-blue-400 hover:underline"),w(t,"class","flex items-center justify-between px-3 py-2 border-b border-gray-700"),w(g,"class","max-h-64 overflow-auto text-xs"),w(e,"class","rounded-lg border border-gray-700 bg-gray-900/60")},m(m,I){z(m,e,I),n(e,t),n(t,s),n(t,d),n(t,f),n(e,c),y&&y.m(e,null),n(e,u),n(e,g);for(let a=0;a<_.length;a+=1)_[a]&&_[a].m(g,null);S||(C=Re(f,"click",l[2]),S=!0)},p(m,[I]){if(m[1]?y?y.p(m,I):(y=ye(m),y.c(),y.m(e,u)):y&&(y.d(1),y=null),I&1){D=te(m[0]);let a;for(a=0;a<D.length;a+=1){const R=we(m,D,a);_[a]?_[a].p(R,I):(_[a]=xe(R),_[a].c(),_[a].m(g,null))}for(;a<_.length;a+=1)_[a].d(1);_.length=D.length}},i:Z,o:Z,d(m){m&&b(e),y&&y.d(),Ce(_,m),S=!1,C()}}}function Le(l,e,t){let{pollMs:s=3e3}=e,{max:r=200}=e,{level:d}=e,f=[],i=null;async function c(){try{const u=new URLSearchParams;u.set("limit",String(r)),d&&u.set("level",d);const g=await fetch(`${ae}/analytics/logs?${u.toString()}`,{credentials:"include"});if(!g.ok)throw new Error(`HTTP ${g.status}`);t(0,f=await g.json()),t(1,i=null)}catch(u){t(1,i=u.message)}}return oe(()=>{c();const u=setInterval(c,s);re(()=>clearInterval(u))}),l.$$set=u=>{"pollMs"in u&&t(3,s=u.pollMs),"max"in u&&t(4,r=u.max),"level"in u&&t(5,d=u.level)},[f,i,c,s,r,d]}class Ne extends se{constructor(e){super(),le(this,e,Le,Pe,ne,{pollMs:3,max:4,level:5})}}function De(l,e,t){const s=l.slice();return s[4]=e[t],s}function Se(l){let e,t;return{c(){e=E("div"),t=L(l[1]),this.h()},l(s){e=$(s,"DIV",{class:!0});var r=T(e);t=P(r,l[1]),r.forEach(b),this.h()},h(){w(e,"class","p-3 text-red-400 text-sm")},m(s,r){z(s,e,r),n(e,t)},p(s,r){r&2&&M(t,s[1])},d(s){s&&b(e)}}}function Ie(l){let e,t,s=l[4].session_id+"",r,d,f,i=new Date(l[4].created_at).toLocaleString()+"",c,u,g,S=l[4].total_requests+"",C,y,D,_=l[4].total_errors+"",m,I,a,R=l[4].total_processing_time_ms+"",p,h;return{c(){e=E("tr"),t=E("td"),r=L(s),d=k(),f=E("td"),c=L(i),u=k(),g=E("td"),C=L(S),y=k(),D=E("td"),m=L(_),I=k(),a=E("td"),p=L(R),h=k(),this.h()},l(v){e=$(v,"TR",{class:!0});var o=T(e);t=$(o,"TD",{class:!0});var q=T(t);r=P(q,s),q.forEach(b),d=A(o),f=$(o,"TD",{class:!0});var V=T(f);c=P(V,i),V.forEach(b),u=A(o),g=$(o,"TD",{class:!0});var H=T(g);C=P(H,S),H.forEach(b),y=A(o),D=$(o,"TD",{class:!0});var U=T(D);m=P(U,_),U.forEach(b),I=A(o),a=$(o,"TD",{class:!0});var ee=T(a);p=P(ee,R),ee.forEach(b),h=A(o),o.forEach(b),this.h()},h(){w(t,"class","px-3 py-2 font-mono"),w(f,"class","px-3 py-2"),w(g,"class","px-3 py-2"),w(D,"class","px-3 py-2"),w(a,"class","px-3 py-2"),w(e,"class","border-t border-gray-800 hover:bg-gray-800/40")},m(v,o){z(v,e,o),n(e,t),n(t,r),n(e,d),n(e,f),n(f,c),n(e,u),n(e,g),n(g,C),n(e,y),n(e,D),n(D,m),n(e,I),n(e,a),n(a,p),n(e,h)},p(v,o){o&1&&s!==(s=v[4].session_id+"")&&M(r,s),o&1&&i!==(i=new Date(v[4].created_at).toLocaleString()+"")&&M(c,i),o&1&&S!==(S=v[4].total_requests+"")&&M(C,S),o&1&&_!==(_=v[4].total_errors+"")&&M(m,_),o&1&&R!==(R=v[4].total_processing_time_ms+"")&&M(p,R)},d(v){v&&b(e)}}}function Me(l){let e,t,s,r="Recent Sessions",d,f,i="Refresh",c,u,g,S,C,y='<tr><th class="px-3 py-2">Session</th> <th class="px-3 py-2">Created</th> <th class="px-3 py-2">Requests</th> <th class="px-3 py-2">Errors</th> <th class="px-3 py-2">Proc (ms)</th></tr>',D,_,m,I,a=l[1]&&Se(l),R=te(l[0]),p=[];for(let h=0;h<R.length;h+=1)p[h]=Ie(De(l,R,h));return{c(){e=E("div"),t=E("div"),s=E("div"),s.textContent=r,d=k(),f=E("button"),f.textContent=i,c=k(),a&&a.c(),u=k(),g=E("div"),S=E("table"),C=E("thead"),C.innerHTML=y,D=k(),_=E("tbody");for(let h=0;h<p.length;h+=1)p[h].c();this.h()},l(h){e=$(h,"DIV",{class:!0});var v=T(e);t=$(v,"DIV",{class:!0});var o=T(t);s=$(o,"DIV",{class:!0,"data-svelte-h":!0}),X(s)!=="svelte-1d3eqnm"&&(s.textContent=r),d=A(o),f=$(o,"BUTTON",{class:!0,"data-svelte-h":!0}),X(f)!=="svelte-9svlmm"&&(f.textContent=i),o.forEach(b),c=A(v),a&&a.l(v),u=A(v),g=$(v,"DIV",{class:!0});var q=T(g);S=$(q,"TABLE",{class:!0});var V=T(S);C=$(V,"THEAD",{class:!0,"data-svelte-h":!0}),X(C)!=="svelte-1dstrq3"&&(C.innerHTML=y),D=A(V),_=$(V,"TBODY",{});var H=T(_);for(let U=0;U<p.length;U+=1)p[U].l(H);H.forEach(b),V.forEach(b),q.forEach(b),v.forEach(b),this.h()},h(){w(s,"class","text-sm font-semibold"),w(f,"class","text-xs text-blue-400 hover:underline"),w(t,"class","flex items-center justify-between px-3 py-2 border-b border-gray-700"),w(C,"class","bg-gray-800 text-gray-300"),w(S,"class","min-w-full text-left text-xs"),w(g,"class","overflow-auto"),w(e,"class","rounded-lg border border-gray-700 bg-gray-900/60")},m(h,v){z(h,e,v),n(e,t),n(t,s),n(t,d),n(t,f),n(e,c),a&&a.m(e,null),n(e,u),n(e,g),n(g,S),n(S,C),n(S,D),n(S,_);for(let o=0;o<p.length;o+=1)p[o]&&p[o].m(_,null);m||(I=Re(f,"click",l[2]),m=!0)},p(h,[v]){if(h[1]?a?a.p(h,v):(a=Se(h),a.c(),a.m(e,u)):a&&(a.d(1),a=null),v&1){R=te(h[0]);let o;for(o=0;o<R.length;o+=1){const q=De(h,R,o);p[o]?p[o].p(q,v):(p[o]=Ie(q),p[o].c(),p[o].m(_,null))}for(;o<p.length;o+=1)p[o].d(1);p.length=R.length}},i:Z,o:Z,d(h){h&&b(e),a&&a.d(),Ce(p,h),m=!1,I()}}}function je(l,e,t){let{pageSize:s=20}=e,r=[],d=null;async function f(){try{const i=new URLSearchParams;i.set("limit",String(s));const c=await fetch(`${ae}/analytics/sessions?${i.toString()}`,{credentials:"include"});if(!c.ok)throw new Error(`HTTP ${c.status}`);t(0,r=await c.json()),t(1,d=null)}catch(i){t(1,d=i.message)}}return oe(f),l.$$set=i=>{"pageSize"in i&&t(3,s=i.pageSize)},[r,d,f,s]}class He extends se{constructor(e){super(),le(this,e,je,Me,ne,{pageSize:3})}}function Te(l){let e,t;return{c(){e=E("div"),t=L(l[1]),this.h()},l(s){e=$(s,"DIV",{class:!0});var r=T(e);t=P(r,l[1]),r.forEach(b),this.h()},h(){w(e,"class","p-3 rounded bg-red-900/40 border border-red-700")},m(s,r){z(s,e,r),n(e,t)},p(s,r){r&2&&M(t,s[1])},d(s){s&&b(e)}}}function Oe(l){var H,U,ee,ie,ce,fe,ue;let e,t,s,r="Overview",d,f,i,c,u,g,S,C,y,D,_,m,I,a,R,p,h,v,o,q,V=l[1]&&Te(l);return c=new Q({props:{title:"Requests / min",value:(H=l[0])==null?void 0:H.requests_per_minute}}),g=new Q({props:{title:"Avg response (ms)",value:(U=l[0])==null?void 0:U.average_response_time}}),C=new Q({props:{title:"Success rate (%)",value:(ee=l[0])==null?void 0:ee.success_rate}}),D=new Q({props:{title:"Active sessions",value:(ie=l[0])==null?void 0:ie.active_sessions}}),m=new Q({props:{title:"Cost today (USD)",value:(ce=l[0])==null?void 0:ce.total_cost_today}}),a=new Q({props:{title:"Top errors",value:((ue=(fe=l[0])==null?void 0:fe.top_errors)==null?void 0:ue[0])??"-"}}),h=new Ne({}),o=new He({}),{c(){e=E("div"),t=E("div"),s=E("h1"),s.textContent=r,d=k(),V&&V.c(),f=k(),i=E("div"),K(c.$$.fragment),u=k(),K(g.$$.fragment),S=k(),K(C.$$.fragment),y=k(),K(D.$$.fragment),_=k(),K(m.$$.fragment),I=k(),K(a.$$.fragment),R=k(),p=E("div"),K(h.$$.fragment),v=k(),K(o.$$.fragment),this.h()},l(x){e=$(x,"DIV",{class:!0});var j=T(e);t=$(j,"DIV",{class:!0});var O=T(t);s=$(O,"H1",{class:!0,"data-svelte-h":!0}),X(s)!=="svelte-hrvmfv"&&(s.textContent=r),d=A(O),V&&V.l(O),f=A(O),i=$(O,"DIV",{class:!0});var N=T(i);F(c.$$.fragment,N),u=A(N),F(g.$$.fragment,N),S=A(N),F(C.$$.fragment,N),y=A(N),F(D.$$.fragment,N),_=A(N),F(m.$$.fragment,N),I=A(N),F(a.$$.fragment,N),N.forEach(b),R=A(O),p=$(O,"DIV",{class:!0});var Y=T(p);F(h.$$.fragment,Y),v=A(Y),F(o.$$.fragment,Y),Y.forEach(b),O.forEach(b),j.forEach(b),this.h()},h(){w(s,"class","text-2xl font-semibold mb-6"),w(i,"class","grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4"),w(p,"class","mt-8 grid grid-cols-1 lg:grid-cols-2 gap-4"),w(t,"class","mx-auto max-w-7xl p-6"),w(e,"class","min-h-screen bg-gray-900 text-gray-100")},m(x,j){z(x,e,j),n(e,t),n(t,s),n(t,d),V&&V.m(t,null),n(t,f),n(t,i),W(c,i,null),n(i,u),W(g,i,null),n(i,S),W(C,i,null),n(i,y),W(D,i,null),n(i,_),W(m,i,null),n(i,I),W(a,i,null),n(t,R),n(t,p),W(h,p,null),n(p,v),W(o,p,null),q=!0},p(x,[j]){var me,ge,_e,pe,be,$e,Ee;x[1]?V?V.p(x,j):(V=Te(x),V.c(),V.m(t,f)):V&&(V.d(1),V=null);const O={};j&1&&(O.value=(me=x[0])==null?void 0:me.requests_per_minute),c.$set(O);const N={};j&1&&(N.value=(ge=x[0])==null?void 0:ge.average_response_time),g.$set(N);const Y={};j&1&&(Y.value=(_e=x[0])==null?void 0:_e.success_rate),C.$set(Y);const de={};j&1&&(de.value=(pe=x[0])==null?void 0:pe.active_sessions),D.$set(de);const he={};j&1&&(he.value=(be=x[0])==null?void 0:be.total_cost_today),m.$set(he);const ve={};j&1&&(ve.value=((Ee=($e=x[0])==null?void 0:$e.top_errors)==null?void 0:Ee[0])??"-"),a.$set(ve)},i(x){q||(J(c.$$.fragment,x),J(g.$$.fragment,x),J(C.$$.fragment,x),J(D.$$.fragment,x),J(m.$$.fragment,x),J(a.$$.fragment,x),J(h.$$.fragment,x),J(o.$$.fragment,x),q=!0)},o(x){G(c.$$.fragment,x),G(g.$$.fragment,x),G(C.$$.fragment,x),G(D.$$.fragment,x),G(m.$$.fragment,x),G(a.$$.fragment,x),G(h.$$.fragment,x),G(o.$$.fragment,x),q=!1},d(x){x&&b(e),V&&V.d(),B(c),B(g),B(C),B(D),B(m),B(a),B(h),B(o)}}}function Ue(l,e,t){let s=null,r=null,d=null;async function f(){try{t(0,s=await Ve("/analytics/dashboard"))}catch(i){t(1,r=i.message)}}return oe(()=>{f();try{d=Ae("/analytics/stream",i=>{try{const c=JSON.parse(i.data);c!=null&&c.timestamp&&t(0,s=c)}catch{}})}catch{console.warn("SSE unavailable, falling back to polling");const c=setInterval(f,5e3);re(()=>clearInterval(c))}}),re(()=>{d==null||d.close()}),[s,r]}class Ge extends se{constructor(e){super(),le(this,e,Ue,Oe,ne,{})}}export{Ge as component};
